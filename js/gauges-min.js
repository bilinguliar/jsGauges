var jsGauges={settings:{rpm:{gaugeRadius:100,step:1,stepStroke:5,subStep:0,subStepStroke:2,subSubStep:0,font:"12px Arial",fontColor:"#000",fontStroke:0,textMargin:13,max:18e3,min:1e3,scaleDivisionValue:1e3,textNumRatio:1e3,startAngle:225,gradAngle:270,background:"270-#E4E4E4-#bbb",strokeColor:"#454343",strokeOpacity:1,strokeWidth:10,handColor:"270-#FF9A00-#FF7B00",handStrokeColor:"#000",handStrokeWidth:1,handOpacity:1,handMaxWidth:30,handMinWidth:4,handLengthTune:-30,handHolder:40,handHolderColor:"270-#E4E4E4-#bbb",handHolderStroke:5,handHolderStrkClr:"#454343",graduationColor:"#000",graduationLength:7,graduationMargin:5,redZoneStart:15e3,redZoneEnd:18e3,redZoneColor:"#A30000",redZoneOpacity:1,alarmShow:true,alarmSignWidth:30,alarmFill:"white",alarmStroke:"red",alarmStrokeWidth:3,alarmBlink:false,alarmGlow:"white",alarmFont:"18px Arial",alarmFontColor:"#000",alarmText:"!",gaugeText:"x100 \n RPM",gaugeTextX:0,gaugeTextY:70,gaugeTextColor:"#454343",gaugeTextFont:"12px Arial"},speed:{gaugeRadius:150,step:10,stepStroke:3,subStep:5,subStepStroke:1,subSubStep:1,font:"13px Arial",fontColor:"#FF8900",fontStroke:0,textMargin:15,max:300,min:0,scaleDivisionValue:2,textNumRatio:1,startAngle:225,gradAngle:270,background:"r#292929-#101010",strokeColor:"#fff",strokeOpacity:1,strokeWidth:5,handColor:"#A01515",handStrokeColor:"#000",handStrokeWidth:0,handOpacity:1,handMaxWidth:8,handMinWidth:4,handLengthTune:0,handHolder:10,handHolderColor:"r#292929-#101010",handHolderStroke:0,handHolderStrkClr:"#000",graduationColor:"#C3C3C3",graduationLength:15,graduationMargin:10,redZoneStart:false,redZoneEnd:false,redZoneColor:"#A30000",redZoneOpacity:1,alarmShow:true,alarmSignWidth:35,alarmFill:"white",alarmStroke:"red",alarmStrokeWidth:3,alarmBlink:false,alarmGlow:"white",alarmFont:"18px Arial",alarmFontColor:"#000",alarmText:"!",gaugeText:"km/h",gaugeTextX:0,gaugeTextY:50,gaugeTextColor:"#FF8900",gaugeTextFont:"15px Arial"},test:{gaugeRadius:150,step:10,stepStroke:3,subStep:5,subStepStroke:2,subSubStep:1,font:"12px Arial",fontColor:"black",fontStroke:0,textMargin:20,max:1e3,min:0,scaleDivisionValue:10,textNumRatio:1,startAngle:180,gradAngle:270,background:"white",strokeColor:"#636363",strokeOpacity:0,strokeWidth:0,handColor:"#A01515",handStrokeColor:"#A01515",handStrokeWidth:0,handOpacity:1,handMaxWidth:3,handMinWidth:1,handLengthTune:0,handHolder:0,handHolderColor:"#fff",handHolderStroke:1,handHolderStrkClr:"#636363",graduationColor:"#636363",graduationLength:20,graduationMargin:5,redZoneStart:800,redZoneEnd:1e3,redZoneColor:"#D92F2F",redZoneOpacity:1,alarmShow:true,alarmSignWidth:30,alarmFill:"white",alarmStroke:"red",alarmStrokeWidth:3,alarmBlink:false,alarmGlow:"white",alarmFont:"18px Arial",alarmFontColor:"#000",alarmText:"!",gaugeText:"Precision \n somethingmeter",gaugeTextX:0,gaugeTextY:-30,gaugeTextColor:"#636363",gaugeTextFont:"10px Arial"},load:{gaugeRadius:150,step:10,stepStroke:3,subStep:5,subStepStroke:2,subSubStep:1,font:"14px Arial",fontColor:"black",fontStroke:0,textMargin:20,max:1e3,min:0,scaleDivisionValue:10,textNumRatio:1,startAngle:180,gradAngle:330,background:"white",strokeColor:"#000",strokeOpacity:1,strokeWidth:1,handColor:"#000",handStrokeColor:"#000",handStrokeWidth:0,handOpacity:1,handMaxWidth:5,handMinWidth:1,handLengthTune:0,handHolder:5,handHolderColor:"#000",handHolderStroke:0,handHolderStrkClr:"#000",graduationColor:"#000",graduationLength:20,graduationMargin:5,redZoneStart:900,redZoneEnd:1e3,redZoneColor:"#D92F2F",redZoneOpacity:1,alarmShow:true,alarmSignWidth:30,alarmFill:"white",alarmStroke:"red",alarmStrokeWidth:3,alarmBlink:false,alarmGlow:"white",alarmFont:"18px Arial",alarmFontColor:"#000",alarmText:"!",gaugeText:"Precision \n somethingmeter",gaugeTextX:0,gaugeTextY:40,gaugeTextColor:"#000",gaugeTextFont:"10px Arial"},temp:{animationTime:100,alarmShow:true,alarmBlink:false,alarmText:"!",alarmFont:"30px Arial",alarmFontColor:"#000",alarmGlow:"white",alarmFill:"white",alarmStroke:"red",alarmStrokeWidth:3,gaugeHeight:300,gaugeWidth:100,step:10,subStep:5,subSubStep:1,max:50,min:-50,scaleDivisionValue:1,textNumRatio:1,background:"0-#000-#272727:40-#000",strokeColor:"#313131",strokeOpacity:1,strokeWidth:4,greenValueStart:20,greenValueEnd:27,columnGreenColor:"0-#5C8926-#71A138:30-#5C8926",yellowValueStart:28,yellowValueEnd:34,columnYellowColor:"0-#CEAC39-#E0C362:30-#CEAC39",redValueStart:35,redValueEnd:51,columnRedColor:"0-#9E1313-#D64646:30-#9E1313",columnWidth:50,columnMarginY:20,columnStroke:"none",columnStrokeWidth:0,columnStrokeOpacity:1,graduationColor:"#777777",gradRedZoneColor:"#9E0000",textMarginRight:10,font:"10px Arial",fontColor:"#C3C3C3",redZoneStart:30,redZoneEnd:50,gaugeText:"Temperature",gaugeTextX:0,gaugeTextY:143,gaugeTextColor:"#fff",gaugeTextFont:"10px Arial"},level:{animationTime:100,alarmShow:true,alarmBlink:false,alarmText:"!",alarmFont:"30px Arial",alarmFontColor:"#000",alarmGlow:"white",alarmFill:"white",alarmStroke:"red",alarmStrokeWidth:3,gaugeHeight:300,gaugeWidth:100,step:10,subStep:5,subSubStep:1,max:100,min:0,scaleDivisionValue:1,textNumRatio:1,background:"#fff",strokeColor:"#005708",strokeOpacity:0,strokeWidth:0,greenValueStart:0,greenValueEnd:33,columnGreenColor:"0-#5C8926-#71A138:30-#5C8926",yellowValueStart:34,yellowValueEnd:67,columnYellowColor:"0-#CEAC39-#E0C362:30-#CEAC39",redValueStart:68,redValueEnd:101,columnRedColor:"0-#9E1313-#D64646:30-#9E1313",columnWidth:50,columnMarginY:20,columnStroke:"none",columnStrokeWidth:0,columnStrokeOpacity:1,graduationColor:"#000",gradRedZoneColor:"#9E0000",textMarginRight:10,font:"10px Arial",fontColor:"#000",redZoneStart:90,redZoneEnd:100,gaugeText:"LOAD",gaugeTextX:0,gaugeTextY:143,gaugeTextColor:"#000",gaugeTextFont:"10px Arial"}},getData:function(){var a=new XMLHttpRequest;jsGauges.settings.targetDiv=document.getElementById("jsGauges");jsGauges.settings.interval=1e4;a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){if(!jsGauges.json){jsGauges.json=JSON.parse(a.responseText);jsGauges.placeDivs()}else{jsGauges.json=JSON.parse(a.responseText);jsGauges.update()}}}};a.open("GET","jsgauges.json"+"?r="+Math.random(),true);a.setRequestHeader("Content-type","application/x-javascript");a.send(null)},placeDivs:function(){var a=document.createDocumentFragment(),b,c;if(jsGauges.json.round){for(var d in jsGauges.json.round){b=document.createElement("div");b.id=d;b.className="roundGauge";a.appendChild(b)}}if(jsGauges.json.linear){for(var d in jsGauges.json.linear){c=document.createElement("div");c.id=d;c.className="linearGauge";a.appendChild(c)}}jsGauges.settings.targetDiv.appendChild(a);jsGauges.placeGauges()},placeGauges:function(){function d(b,c){var d=c.gaugeHeight+c.strokeWidth,e=c.gaugeWidth+c.strokeWidth;jsGauges[b.id]={};jsGauges[b.id].paper=Raphael(b,e,d);var f=jsGauges[b.id].paper,g=c.strokeWidth/2,h=f.rect(g,g,c.gaugeWidth,c.gaugeHeight),i=(c.max-c.min)/c.scaleDivisionValue,j=(c.gaugeHeight-c.columnMarginY*2)/i,k=(c.gaugeWidth-g-c.columnWidth)/2,l=c.gaugeHeight-c.columnMarginY*2,m=g+c.columnMarginY+l,n=e/2-c.columnWidth/2,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;jsGauges.settings[b.id].columnMaxHeight=l;jsGauges.settings[b.id].gradAmount=i;jsGauges.settings[b.id].columnStartX=n;jsGauges.settings[b.id].columnStartY=m;jsGauges.toUpdate[b.id]={};h.attr({fill:c.background,stroke:c.strokeColor,"stroke-opacity":c.strokeOpacity,"stroke-width":c.strokeWidth});for(var D=0;D<=i;D+=1){q=n;r=g+c.columnMarginY+l-D*j;if(D%c.step===0){s=c.min+D*c.scaleDivisionValue;f.text(c.gaugeWidth-c.textMarginRight,r,s/c.textNumRatio).attr({font:c.font,fill:c.fontColor,"stroke-width":0});q-=k*.1;u="l -"+k*.9+", 0"}else if(D%c.subStep===0){q-=k*.25;u="l -"+k*.75+", 0"}else if(D%c.subSubStep===0){q-=k*.5;u="l -"+k*.5+", 0"}if(c.min+D*c.scaleDivisionValue>=c.redZoneStart&&c.min+D*c.scaleDivisionValue<=c.redZoneEnd){t=c.gradRedZoneColor}else{t=c.graduationColor}f.path("M"+q+","+r+u).attr({stroke:t})}o={width:c.columnWidth,startX:n,startY:m-l/2,alarmAttr:{fill:c.alarmFill,stroke:c.alarmStroke,"stroke-width":c.alarmStrokeWidth},alarmGlow:c.alarmGlow};p={textX:n+c.columnWidth/2,textY:m-l/2-c.columnWidth/2+parseInt(c.alarmFont)/4,alarmTextAttr:{font:c.alarmFont,fill:c.alarmFontColor},textData:c.alarmText};a(b.id,o,p,c);if(c.gaugeText){f.text(c.gaugeTextX+c.gaugeWidth/2,c.gaugeTextY+c.gaugeHeight/2,c.gaugeText).attr({fill:c.gaugeTextColor,font:c.gaugeTextFont})}}function c(b,c){var d=paperWidth=(c.gaugeRadius+1+c.strokeWidth)*2;jsGauges[b.id]={};jsGauges[b.id].paper=Raphael(b,paperWidth,d);var e=jsGauges[b.id].paper,f=c.gaugeRadius,g=circleY=c.gaugeRadius+c.strokeWidth/2,h=e.circle(g,circleY,f),i=c.startAngle,j=e.set(),k=(c.max-c.min)/c.scaleDivisionValue,l=c.graduationLength,m=e.set(),n=c.gradAngle,o=n/k,p=360/o,q=c.graduationMargin,r=Math.PI*2/p,s=c.scaleDivisionValue,t=f-q,u=t-l,v=f-q-l/2,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;jsGauges.toUpdate[b.id]={};jsGauges.toUpdate[b.id].handLength=f-q-l;jsGauges.settings[b.id].circleX=g;h.attr({fill:c.background,stroke:c.strokeColor,"stroke-opacity":c.strokeOpacity,"stroke-width":c.strokeWidth});for(var M=0;M<=k;M+=1){var N=r*(M+i/o)-Math.PI/2,O=Math.cos(N),P=Math.sin(N),Q=(M+c.min/s)*s;E=g+t*O;G=circleY+t*P;if(c.redZoneStart&&Q==c.redZoneStart){x=g+(u+l*.5)*O;y=circleY+(u+l*.5)*P}if(c.redZoneStart&&Q==c.redZoneEnd){z=g+(u+l*.5)*O;A=circleY+(u+l*.5)*P;w=e.path([["M",x,y],["A",v,v,0,0,1,z,A]]);w.attr({fill:"none",stroke:c.redZoneColor,"stroke-opacity":c.redZoneOpacity,"stroke-width":l})}if(M%c.step===0){D=.9;J=g+(u*D-c.textMargin)*O;K=circleY+(u*D-c.textMargin)*P;L=Q/c.textNumRatio;I=c.stepStroke;e.text(J,K,L).attr({"stroke-width":c.fontStroke,font:c.font,fill:c.fontColor})}else if(M%c.subStep===0){D=.95;I=c.subStepStroke}else if(M%c.subSubStep===0){D=.99;I=c.subSubStepStroke}F=g+u*D*O;H=circleY+u*D*P;j.push(e.path([["M",E,G],["L",F,H]]).attr({"stroke-width":I,stroke:c.graduationColor}))}j.toFront();B={width:c.alarmSignWidth,startX:g-c.alarmSignWidth/2,startY:circleY+c.alarmSignWidth/2,alarmAttr:{fill:c.alarmFill,stroke:c.alarmStroke,"stroke-width":c.alarmStrokeWidth},alarmGlow:c.alarmGlow};C={textX:B.startX+B.width/2,textY:B.startY+B.width/5-parseInt(c.alarmFont),alarmTextAttr:{font:c.alarmFont,fill:c.alarmFontColor},textData:c.alarmText};a(b.id,B,C,c);if(c.gaugeText){e.text(c.gaugeTextX+g,c.gaugeTextY+circleY,c.gaugeText).attr({fill:c.gaugeTextColor,font:c.gaugeTextFont})}}function b(a,b){var c=[],d=new RegExp("(^| )"+b+"( |$)"),e=a.getElementsByTagName("*");for(var f=0,g=e.length;f<g;f+=1){if(d.test(e[f].className)){c.push(e[f])}}return c}function a(a,b,c,d){if(!d.alarmShow){return}var e=jsGauges[a].paper,f=b.width,g="0",h="-"+f/2,i="-"+f,j,k,l,m=jsGauges.toUpdate[a].alarmSet=e.set();j=e.path("M"+b.startX+","+b.startY+"l"+f+","+g+" "+h+","+i+"z");j.attr(b.alarmAttr);l=j.glow();l.attr({stroke:b.alarmGlow});k=e.text(c.textX,c.textY,c.textData);k.attr(c.alarmTextAttr);m.push(l,j,k)}jsGauges.toUpdate={};jsGauges.roundGauges=b(jsGauges.settings.targetDiv,"roundGauge");jsGauges.linearGauges=b(jsGauges.settings.targetDiv,"linearGauge");for(var e=0;e<jsGauges.roundGauges.length;e+=1){if(jsGauges.settings[jsGauges.roundGauges[e].id]){c(jsGauges.roundGauges[e],jsGauges.settings[jsGauges.roundGauges[e].id])}else{alert("You don't have settings for round gauge with ID: "+jsGauges.roundGauges[e].id)}}for(var f=0;f<jsGauges.linearGauges.length;f+=1){if(jsGauges.settings[jsGauges.linearGauges[f].id]){d(jsGauges.linearGauges[f],jsGauges.settings[jsGauges.linearGauges[f].id])}else{alert("You don't have settings for linear gauge with ID: "+jsGauges.linearGauges[f].id)}}jsGauges.update();setInterval(function(){jsGauges.getData()},jsGauges.settings.interval)},update:function(){function d(a,b){if(b>=a.greenValueStart&&b<=a.greenValueEnd){return a.columnGreenColor}else if(b>=a.yellowValueStart&&b<=a.yellowValueEnd){return a.columnYellowColor}else if(b>=a.redValueStart&&b<=a.redValueEnd){return a.columnRedColor}else{alert("Current linear gauge value do not match any color zone");return"pink"}}function c(a,b,c){var d=b.circleX,e=d,f=jsGauges.toUpdate[a].hand,g=(b.max-b.min)/b.gradAngle,h=b.startAngle-180;f.angle=(c-b.min)/g+h;f.animate({transform:"r"+f.angle+" "+d+" "+e},500)}function b(a,b,c,d){if(!c.alarmShow){return}if(b>=c.redZoneStart&&b<=c.redZoneEnd){a.toFront();if(c.alarmBlink){jsGauges.toUpdate[d].blink=setInterval(function(){a.show();setTimeout(function(){a.hide()},500);setTimeout(function(){clearInterval(jsGauges.toUpdate[d].blink)},jsGauges.settings.interval)},1e3)}else{a.show()}}else{a.hide()}}function a(a,b,c){if(jsGauges.json[a][b]<=c.max){return jsGauges.json[a][b]}else{return c.max*1.1}if(jsGauges.json[a][b]>=c.min){return jsGauges.json[a][b]}else{return c.min}}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(var w=0;w<jsGauges.roundGauges.length;w+=1){f=jsGauges.roundGauges[w].id;g=jsGauges.settings[f];v=jsGauges.toUpdate[f].alarmSet;u=a("round",f,g);if(!jsGauges.toUpdate[f].hand){h=jsGauges[f].paper;p=g.circleX;q=p;j=g.handMaxWidth;k=(g.handMaxWidth-g.handMinWidth)/2;n=jsGauges.toUpdate[f].handLength+g.handLengthTune;l=g.handMinWidth;i="M"+(p-j/2)+","+q+"l"+j+",0 -"+k+","+n+" -"+l+",0z";jsGauges.toUpdate[f].hand=h.path(i).attr({fill:g.handColor,stroke:g.handStrokeColor,"stroke-width":g.handStrokeWidth,opacity:g.handOpacity});c(f,g,u);if(g.handHolder){h.circle(p,q,g.handHolder).attr({fill:g.handHolderColor,stroke:g.handHolderStrkClr,"stroke-width":g.handHolderStroke})}}else{c(f,g,u)}b(v,u,g,f)}for(var x=0;x<jsGauges.linearGauges.length;x+=1){e=jsGauges.linearGauges[x].id;g=jsGauges.settings[e];v=jsGauges.toUpdate[e].alarmSet;u=a("linear",e,g);h=jsGauges[e].paper;t=g.columnMaxHeight*(u/((g.max-g.min)/100)/100);s=d(g,u);j=g.columnWidth;m="0";k="0";n="-"+t;l="-"+g.columnWidth;o="0";r="M"+g.columnStartX+","+g.columnStartY+"l"+j+","+m+" "+k+","+n+" "+l+","+o+"z";if(!jsGauges.toUpdate[e].column){jsGauges.toUpdate[e].column=h.path(r).attr({fill:s,stroke:g.columnStroke,"stroke-opacity":g.columnStrokeOpacity,"stroke-width":g.columnStrokeWidth})}else{jsGauges.toUpdate[e].column.animate({path:r},g.animationTime).attr({fill:s})}b(v,u,g,e)}},onDomReady:function(a){function c(){if(b)return;b=true;a()}var b=false;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){c()},false)}else if(document.attachEvent){if(document.documentElement.doScroll&&window==window.top){function d(){if(b)return;if(!document.body)return;try{document.documentElement.doScroll("left");c()}catch(a){setTimeout(d,0)}}d()}document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){c()}})}if(window.addEventListener)window.addEventListener("load",c,false);else if(window.attachEvent)window.attachEvent("onload",c)}};jsGauges.onDomReady(jsGauges.getData)
